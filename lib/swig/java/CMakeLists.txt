#
# Copyright (c) 2013 Nicholas Corgan (n.corgan@gmail.com)
#
# Distributed under the MIT License (MIT) (See accompanying file LICENSE.txt
# or copy at http://opensource.org/licenses/MIT)
#

INCLUDE(${SWIG_USE_FILE})

FILE(TO_NATIVE_PATH "${PKMNSIM_SOURCE_DIR}/lib/swig" PKMNSIM_SWIG_SOURCE_DIR)
SET(PKMNSIM_SWIG_SOURCE_DIR ${PKMNSIM_SWIG_SOURCE_DIR} CACHE FILEPATH "Pokemon-sim SWIG source directory")

SET(PKMNSIM_JAVA_INCLUDE_DIRS
    ${PKMNSIM_SOURCE_DIR}/include
    ${PKMNSIM_SWIG_SOURCE_DIR}
    ${Boost_INCLUDE_DIRS}
)

FOREACH(dir ${PKMNSIM_JAVA_INCLUDE_DIRS})
    LIST(APPEND CMAKE_SWIG_FLAGS "-I${dir}")
ENDFOREACH(dir ${PKMNSIM_JAVA_INCLUDE_DIRS})
SET_SOURCE_FILES_PROPERTIES(jpkmnsim_swig.i PROPERTIES CPLUSPLUS ON)

INCLUDE_DIRECTORIES(${PKMNSIM_JAVA_INCLUDE_DIRS} ${JAVA_INCLUDE_PATH} ${JNI_INCLUDE_DIRS})

SET(JAVA_BUILD_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/)
SET(JAVA_INSTALL_DIRECTORY share/java)
FILE(MAKE_DIRECTORY ${JAVA_BUILD_DIRECTORY})
FILE(MAKE_DIRECTORY ${JAVA_BUILD_DIRECTORY})

SET(CMAKE_SWIG_OUTDIR ${JAVA_BUILD_DIRECTORY}/org/nc/jPKMNsim)
SET(CMAKE_SWIG_FLAGS -module jPKMNsim -package "org.nc.jPKMNsim" ${CMAKE_GLOBAL_SWIG_FLAGS})
SWIG_ADD_MODULE(jPKMNsim java jpkmnsim_swig.i)
SWIG_LINK_LIBRARIES(jPKMNsim pkmnsim)
IF(UNIX)
    SET_TARGET_PROPERTIES(${SWIG_MODULE_jPKMNsim_REAL_NAME} PROPERTIES PREFIX "lib")
    SET_TARGET_PROPERTIES(${SWIG_MODULE_jPKMNsim_REAL_NAME} PROPERTIES SUFFIX ".so")
    SET_TARGET_PROPERTIES(${SWIG_MODULE_jPKMNsim_REAL_NAME} PROPERTIES COMPILE_FLAGS "-std=c++0x")
ELSEIF(WIN32)
    SET_TARGET_PROPERTIES(${SWIG_MODULE_jPKMNsim_REAL_NAME} PROPERTIES PREFIX "")
    SET_TARGET_PROPERTIES(${SWIG_MODULE_jPKMNsim_REAL_NAME} PROPERTIES SUFFIX ".dll")
ENDIF(UNIX)

SET(JAVA_SOURCE_CODE ${CMAKE_CURRENT_BINARY_DIR}/org/nc/jPKMNsim/*.java)

ADD_CUSTOM_COMMAND(
    OUTPUT ${JAVA_BUILD_DIRECTORY}/jPKMNsim.jar
    COMMENT "Creating jPKMNsim.jar"
    COMMAND ${Java_JAVAC_EXECUTABLE} -d ${JAVA_BUILD_DIRECTORY} ${JAVA_SOURCE_CODE}
    COMMAND ${Java_JAR_EXECUTABLE} cf ${CMAKE_CURRENT_BINARY_DIR}/jPKMNsim.jar -C ${JAVA_BUILD_DIRECTORY} org
    DEPENDS ${SWIG_MODULE_jPKMNsim_REAL_NAME}
)

ADD_CUSTOM_TARGET(jpkmnsim_jar ALL DEPENDS ${JAVA_BUILD_DIRECTORY}/jPKMNsim.jar)

INSTALL(
    FILES ${JAVA_BUILD_DIRECTORY}/jPKMNsim.jar
    DESTINATION ${JAVA_INSTALL_DIRECTORY}
    COMPONENT "jPKMNsim"
)
